<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{classData.class_name}} - Class Details - FUNLEARN</title>
    <link rel="stylesheet" href="/tailwind.css">
    <link rel="stylesheet" href="/funlearn-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="bg-gray-50">
    {{> header}}

    <div class="container mx-auto px-6 py-8">
        <!-- Success Message -->
        {{#if successMessage}}
        <div class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <span>{{successMessage}}</span>
            </div>
            <button onclick="this.parentElement.style.display='none'" class="text-green-700 hover:text-green-900">
                <i class="fas fa-times"></i>
            </button>
        </div>
        {{/if}}

        <!-- Error Message -->
        {{#if errorMessage}}
        <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
                <span>{{errorMessage}}</span>
            </div>
            <button onclick="this.parentElement.style.display='none'" class="text-red-700 hover:text-red-900">
                <i class="fas fa-times"></i>
            </button>
        </div>
        {{/if}}

        <!-- Class Header -->
        <div class="bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 text-white rounded-3xl p-8 mb-8 shadow-2xl">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold mb-2">{{classData.class_name}}</h1>
                    <p class="text-blue-100 text-lg mb-4">{{classData.description}}</p>
                    <div class="flex items-center space-x-6 text-sm">
                        <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2">
                            <span class="text-blue-200">Class Code:</span>
                            <span class="font-bold ml-2">{{classData.class_code}}</span>
                        </div>
                        {{#if classData.academic_year}}
                        <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2">
                            <span class="text-blue-200">Academic Year:</span>
                            <span class="font-bold ml-2">{{classData.academic_year}}</span>
                        </div>
                        {{/if}}
                        {{#if classData.semester}}
                        <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2">
                            <span class="text-blue-200">Semester:</span>
                            <span class="font-bold ml-2">{{classData.semester}}</span>
                        </div>
                        {{/if}}
                    </div>
                </div>
                <div class="hidden lg:block">
                    <div class="w-24 h-24 bg-white/10 rounded-2xl flex items-center justify-center text-5xl backdrop-blur-sm">
                        üë•
                    </div>
                </div>
            </div>
        </div>

        <!-- Class Stats -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Total Students</p>
                        <p class="stat-value text-blue-600">{{classData.students.length}}</p>
                    </div>
                    <div class="text-4xl opacity-20">üë•</div>
                </div>
            </div>

            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Active Students</p>
                        <p class="stat-value text-green-600">{{classData.students.length}}</p>
                    </div>
                    <div class="text-4xl opacity-20">‚úÖ</div>
                </div>
            </div>

            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Class Status</p>
                        <p class="stat-value text-purple-600">
                            {{#if classData.is_active}}Active{{else}}Inactive{{/if}}
                        </p>
                    </div>
                    <div class="text-4xl opacity-20">
                        {{#if classData.is_active}}üü¢{{else}}üî¥{{/if}}
                    </div>
                </div>
            </div>

            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Created</p>
                        <p class="stat-value text-gray-600 text-lg">
                            {{#if classData.created_at}}
                                {{substring classData.created_at 0 10}}
                            {{else}}
                                N/A
                            {{/if}}
                        </p>
                    </div>
                    <div class="text-4xl opacity-20">üìÖ</div>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Students List -->
                <div class="card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üë• Class Students</h2>
                        <div class="flex items-center space-x-3">
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">
                                {{classData.students.length}} students
                            </span>
                            <button class="btn btn-primary btn-sm" onclick="showAddStudentModal()">
                                <i class="fas fa-plus mr-2"></i>Add Student
                            </button>
                        </div>
                    </div>
                    
                    {{#if classData.students.length}}
                        <div class="space-y-4">
                            {{#each classData.students}}
                            <div class="lesson-item group">
                                <div class="flex items-center flex-1">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4">
                                        {{substring this.first_name 0 1}}{{substring this.last_name 0 1}}
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-gray-800 group-hover:text-blue-600 transition-colors">
                                            {{this.first_name}} {{this.last_name}}
                                        </h3>
                                        <div class="flex items-center space-x-4 mt-1">
                                            <span class="text-sm text-gray-500">{{this.email}}</span>
                                            {{#if this.student_id}}
                                            <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">
                                                ID: {{this.student_id}}
                                            </span>
                                            {{/if}}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <a href="/teacher/classes/{{../classData.id}}/students/{{this.id}}/progress" class="btn btn-secondary btn-sm">
                                        <i class="fas fa-chart-line mr-1"></i>Progress
                                    </a>
                                    <a href="/teacher/classes/{{../classData.id}}/students/{{this.id}}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye mr-1"></i>View
                                    </a>
                                </div>
                            </div>
                            {{/each}}
                        </div>
                    {{else}}
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4 opacity-50">üë•</div>
                            <p class="text-gray-500 mb-4">No students enrolled yet</p>
                            <p class="text-gray-400 text-sm mb-6">Share the class code <strong>{{classData.class_code}}</strong> with students to let them join</p>
                            <button class="btn btn-primary">
                                <i class="fas fa-plus mr-2"></i>Invite Students
                            </button>
                        </div>
                    {{/if}}
                </div>

                <!-- Class Actions -->
                <div class="card p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üéØ Class Management</h2>
                    <div class="grid md:grid-cols-2 gap-4">
                        <a href="/teacher/classes/{{classData.id}}/manage" class="group p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all duration-300">
                            <div class="text-center">
                                <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">üéØ</div>
                                <h3 class="font-semibold text-gray-700 group-hover:text-blue-600">Class Management</h3>
                                <p class="text-sm text-gray-500">Manage assignments, grades & settings</p>
                            </div>
                        </a>
                        
                        <a href="/teacher/classes/{{classData.id}}/progress" class="group p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-green-500 hover:bg-green-50 transition-all duration-300">
                            <div class="text-center">
                                <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">üìä</div>
                                <h3 class="font-semibold text-gray-700 group-hover:text-green-600">Progress Tracking</h3>
                                <p class="text-sm text-gray-500">Monitor student progress</p>
                            </div>
                        </a>
                        
                        <a href="/teacher/classes/{{classData.id}}/grades" class="group p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition-all duration-300">
                            <div class="text-center">
                                <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">üéØ</div>
                                <h3 class="font-semibold text-gray-700 group-hover:text-purple-600">Grades</h3>
                                <p class="text-sm text-gray-500">View and manage grades</p>
                            </div>
                        </a>
                        
                        <a href="/teacher/classes/{{classData.id}}/settings" class="group p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-orange-500 hover:bg-orange-50 transition-all duration-300">
                            <div class="text-center">
                                <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">‚öôÔ∏è</div>
                                <h3 class="font-semibold text-gray-700 group-hover:text-orange-600">Settings</h3>
                                <p class="text-sm text-gray-500">Class configuration</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Class Information -->
                <div class="card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìã Class Information</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Class Code</label>
                            <div class="flex items-center space-x-2">
                                <input type="text" value="{{classData.class_code}}" readonly 
                                       class="form-input bg-gray-50 text-center font-mono font-bold text-lg">
                                <button class="btn btn-secondary btn-sm" onclick="copyClassCode()">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Share this code with students</p>
                        </div>
                        
                        {{#if classData.description}}
                        <div>
                            <label class="form-label">Description</label>
                            <p class="text-gray-700 bg-gray-50 p-3 rounded-lg">{{classData.description}}</p>
                        </div>
                        {{/if}}
                        
                        <div class="flex items-center justify-between pt-4 border-t">
                            <span class="text-sm text-gray-500">Status</span>
                            <span class="px-3 py-1 rounded-full text-sm font-semibold {{#if classData.is_active}}bg-green-100 text-green-800{{else}}bg-red-100 text-red-800{{/if}}">
                                {{#if classData.is_active}}Active{{else}}Inactive{{/if}}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö° Quick Actions</h3>
                    <div class="space-y-3">
                        <button class="w-full btn btn-primary">
                            <i class="fas fa-plus mr-2"></i>Create Assignment
                        </button>
                        <button class="w-full btn btn-secondary">
                            <i class="fas fa-download mr-2"></i>Export Student List
                        </button>
                        <button class="w-full btn btn-secondary">
                            <i class="fas fa-cog mr-2"></i>Class Settings
                        </button>
                        <button class="w-full btn btn-secondary text-red-600 hover:bg-red-50">
                            <i class="fas fa-archive mr-2"></i>Archive Class
                        </button>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìà Recent Activity</h3>
                    <div class="space-y-3">
                        <div class="text-center py-6">
                            <div class="text-4xl mb-2 opacity-50">üìä</div>
                            <p class="text-gray-500 text-sm">No recent activity</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Add Student to Class</h3>
                <button onclick="hideAddStudentModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form action="/teacher/classes/{{classData.id}}/students" method="POST" class="space-y-4">
                <div>
                    <label class="form-label">Student Email *</label>
                    <input type="email" name="studentEmail" required 
                           class="form-input" placeholder="student@email.com">
                    <p class="text-xs text-gray-500 mt-1">Enter the student's email address</p>
                </div>
                
                <div>
                    <label class="form-label">Student ID (Optional)</label>
                    <input type="text" name="studentId" 
                           class="form-input" placeholder="STU001">
                    <p class="text-xs text-gray-500 mt-1">Optional student identification number</p>
                </div>
                
                <div class="flex items-center justify-end space-x-3 pt-4 border-t">
                    <button type="button" onclick="hideAddStudentModal()" class="btn btn-secondary">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus mr-2"></i>Add Student
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function copyClassCode() {
            const classCode = '{{classData.class_code}}';
            navigator.clipboard.writeText(classCode).then(() => {
                // Show success message
                const button = event.target.closest('button');
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check text-green-600"></i>';
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                }, 2000);
            });
        }

        function showAddStudentModal() {
            document.getElementById('addStudentModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function hideAddStudentModal() {
            document.getElementById('addStudentModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Close modal when clicking outside
        document.getElementById('addStudentModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideAddStudentModal();
            }
        });

        // Add interactive animations
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects to cards
            document.querySelectorAll('.card-hover').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });

            // Auto-hide success/error messages after 5 seconds
            const messages = document.querySelectorAll('.bg-green-100, .bg-red-100');
            messages.forEach(message => {
                setTimeout(() => {
                    message.style.opacity = '0';
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 300);
                }, 5000);
            });
        });
    </script>
</body>
</html>