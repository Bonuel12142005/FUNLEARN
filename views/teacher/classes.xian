<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Classes - Teacher - FUNLEARN</title>
    <link rel="stylesheet" href="/tailwind.css">
    <link rel="stylesheet" href="/funlearn-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="bg-gray-50">
    {{> header}}

    <div class="container mx-auto px-6 py-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-4xl font-bold text-gray-800">My Classes</h1>
                <p class="text-gray-600 mt-2">Manage your classes and track student progress</p>
            </div>
            <div class="flex items-center space-x-3">
                <a href="/teacher/dashboard" class="btn btn-secondary">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                </a>
                <a href="/teacher/classes/create" class="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i>New Class
                </a>
            </div>
        </div>

        <!-- Class Stats -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Total Classes</p>
                        <p class="stat-value text-blue-600">{{classes.length}}</p>
                    </div>
                    <div class="text-4xl opacity-20">ðŸ‘¥</div>
                </div>
            </div>

            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Active Classes</p>
                        <p class="stat-value text-green-600">2</p>
                    </div>
                    <div class="text-4xl opacity-20">âœ…</div>
                </div>
            </div>

            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Total Students</p>
                        <p class="stat-value text-purple-600">9</p>
                    </div>
                    <div class="text-4xl opacity-20">ðŸŽ“</div>
                </div>
            </div>

            <div class="stat-card card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="stat-label">Avg. Class Size</p>
                        <p class="stat-value text-orange-600">3</p>
                    </div>
                    <div class="text-4xl opacity-20">ðŸ“Š</div>
                </div>
            </div>
        </div>

        <!-- Filters and Search -->
        <div class="card p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                <div class="flex items-center space-x-4">
                    <div>
                        <input type="search" placeholder="Search classes..." 
                               class="form-input w-64" id="classSearch">
                    </div>
                    <div>
                        <select class="form-input w-40" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div>
                        <select class="form-input w-40" id="semesterFilter">
                            <option value="">All Semesters</option>
                            <option value="Fall">Fall</option>
                            <option value="Spring">Spring</option>
                            <option value="Summer">Summer</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="btn btn-secondary btn-sm" onclick="exportClasses()">
                        <i class="fas fa-download mr-1"></i>Export
                    </button>
                </div>
            </div>
        </div>

        <!-- Classes List -->
        <div id="classesContainer">
            {{#if classes.length}}
                <div class="grid gap-6">
                    {{#each classes}}
                    <div class="class-card card card-hover" data-status="{{#if this.is_active}}active{{else}}inactive{{/if}}" data-semester="{{this.semester}}">
                        <div class="p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <h3 class="text-2xl font-bold text-gray-800">{{this.class_name}}</h3>
                                        {{#if this.is_active}}
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                            Active
                                        </span>
                                        {{else}}
                                        <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-semibold">
                                            Inactive
                                        </span>
                                        {{/if}}
                                    </div>
                                    <p class="text-gray-600 mb-3">{{this.description}}</p>
                                    <div class="flex items-center space-x-6 text-sm text-gray-500">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-semibold">Class Code:</span>
                                            <span class="font-mono bg-gray-100 px-2 py-1 rounded">{{this.class_code}}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="font-semibold">Academic Year:</span>
                                            <span>{{this.academic_year}}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="font-semibold">Semester:</span>
                                            <span>{{this.semester}}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <a href="/teacher/classes/{{this.id}}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-eye mr-1"></i>View Details
                                    </a>
                                    <button class="btn btn-secondary btn-sm" onclick="editClass({{this.id}})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-secondary btn-sm text-red-600" onclick="archiveClass({{this.id}})">
                                        <i class="fas fa-archive"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Students Preview -->
                            <div class="border-t pt-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-gray-700">Students ({{this.students.length}})</h4>
                                    <div class="flex items-center space-x-2">
                                        <a href="/teacher/classes/{{this.id}}/progress" class="btn btn-secondary btn-sm">
                                            <i class="fas fa-chart-line mr-1"></i>Progress
                                        </a>
                                        <a href="/teacher/classes/{{this.id}}/report" class="btn btn-secondary btn-sm">
                                            <i class="fas fa-file-alt mr-1"></i>Report
                                        </a>
                                    </div>
                                </div>
                                
                                {{#if this.students.length}}
                                <div class="flex items-center space-x-2">
                                    {{#each this.students}}
                                    <div class="flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg">
                                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                            {{substring this.first_name 0 1}}{{substring this.last_name 0 1}}
                                        </div>
                                        <span class="text-sm font-medium text-gray-700">{{this.first_name}} {{this.last_name}}</span>
                                    </div>
                                    {{/each}}
                                </div>
                                {{else}}
                                <div class="text-center py-4 text-gray-500">
                                    <i class="fas fa-users text-2xl mb-2 opacity-50"></i>
                                    <p class="text-sm">No students enrolled yet</p>
                                </div>
                                {{/if}}
                            </div>

                            <!-- Quick Actions -->
                            <div class="border-t pt-4 mt-4">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm text-gray-500">
                                        Created on {{substring this.created_at 0 10}}
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button class="btn btn-secondary btn-sm" onclick="copyClassCode('{{this.class_code}}')">
                                            <i class="fas fa-copy mr-1"></i>Copy Code
                                        </button>
                                        <button class="btn btn-secondary btn-sm" onclick="shareClass({{this.id}})">
                                            <i class="fas fa-share mr-1"></i>Share
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                </div>
            {{else}}
                <div class="text-center py-16">
                    <div class="text-8xl mb-6 opacity-50">ðŸ‘¥</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">No classes yet</h3>
                    <p class="text-gray-600 mb-8">Create your first class to start teaching and managing students</p>
                    <button class="btn btn-primary btn-lg" onclick="createClass()">
                        <i class="fas fa-plus mr-2"></i>Create Your First Class
                    </button>
                </div>
            {{/if}}
        </div>
    </div>

    <script>
        // Search and filter functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('classSearch');
            const statusFilter = document.getElementById('statusFilter');
            const semesterFilter = document.getElementById('semesterFilter');
            const classCards = document.querySelectorAll('.class-card');

            function filterClasses() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedStatus = statusFilter.value;
                const selectedSemester = semesterFilter.value;

                classCards.forEach(card => {
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const status = card.dataset.status;
                    const semester = card.dataset.semester;

                    const matchesSearch = title.includes(searchTerm);
                    const matchesStatus = !selectedStatus || status === selectedStatus;
                    const matchesSemester = !selectedSemester || semester === selectedSemester;

                    if (matchesSearch && matchesStatus && matchesSemester) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            searchInput.addEventListener('input', filterClasses);
            statusFilter.addEventListener('change', filterClasses);
            semesterFilter.addEventListener('change', filterClasses);
        });

        // Class actions
        function createClass() {
            alert('Create Class functionality would open a form here (Demo mode)');
        }

        function editClass(classId) {
            alert(`Edit Class ${classId} functionality would open an edit form here (Demo mode)`);
        }

        function archiveClass(classId) {
            if (confirm('Are you sure you want to archive this class? Students will no longer be able to access it.')) {
                alert(`Class ${classId} archived! (Demo mode)`);
            }
        }

        function copyClassCode(classCode) {
            navigator.clipboard.writeText(classCode).then(() => {
                alert(`Class code "${classCode}" copied to clipboard!`);
            }).catch(() => {
                alert(`Class code: ${classCode}`);
            });
        }

        function shareClass(classId) {
            alert(`Share Class ${classId} functionality would generate a shareable link here (Demo mode)`);
        }

        function exportClasses() {
            alert('Export Classes functionality would download a CSV/Excel file here (Demo mode)');
        }

        // Add hover effects to cards
        document.querySelectorAll('.card-hover').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    </script>
</body>
</html>