<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Course - {{course.title}} - FUNLEARN</title>
    <link rel="stylesheet" href="/tailwind.css">
    <link rel="stylesheet" href="/funlearn-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="bg-gray-50">
    {{> header}}

    <div class="container mx-auto px-6 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Success Message -->
            {{#if successMessage}}
            <div class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-3"></i>
                    <span>{{successMessage}}</span>
                </div>
                <button onclick="this.parentElement.style.display='none'" class="text-green-700 hover:text-green-900">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            {{/if}}

            <!-- Error Message -->
            {{#if errorMessage}}
            <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
                    <span>{{errorMessage}}</span>
                </div>
                <button onclick="this.parentElement.style.display='none'" class="text-red-700 hover:text-red-900">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            {{/if}}

            <!-- Header -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-4xl font-bold text-gray-800">Edit Course</h1>
                    <p class="text-gray-600 mt-2">Update "{{course.title}}" information and settings</p>
                </div>
                <div class="flex items-center space-x-3">
                    <a href="/teacher/courses" class="btn btn-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Courses
                    </a>
                </div>
            </div>

            <!-- Course Edit Form -->
            <form action="/teacher/courses/{{course.id}}/edit" method="POST" class="space-y-8">
                <!-- Basic Information -->
                <div class="card p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white text-xl mr-4">
                            üìö
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Course Information</h2>
                            <p class="text-gray-600">Basic details about your course</p>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="form-label">Course Title *</label>
                            <input type="text" name="title" value="{{course.title}}" required 
                                   class="form-input">
                        </div>
                        <div>
                            <label class="form-label">Category *</label>
                            <select name="category" required class="form-input">
                                <option value="">Select a category</option>
                                <option value="Programming" {{#eq course.category "Programming"}}selected{{/eq}}>Programming</option>
                                <option value="Mathematics" {{#eq course.category "Mathematics"}}selected{{/eq}}>Mathematics</option>
                                <option value="Science" {{#eq course.category "Science"}}selected{{/eq}}>Science</option>
                                <option value="Language Arts" {{#eq course.category "Language Arts"}}selected{{/eq}}>Language Arts</option>
                                <option value="History" {{#eq course.category "History"}}selected{{/eq}}>History</option>
                                <option value="Art" {{#eq course.category "Art"}}selected{{/eq}}>Art</option>
                                <option value="Music" {{#eq course.category "Music"}}selected{{/eq}}>Music</option>
                                <option value="Other" {{#eq course.category "Other"}}selected{{/eq}}>Other</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Description</label>
                            <textarea name="description" rows="4" 
                                      class="form-input">{{course.description}}</textarea>
                        </div>
                        <div>
                            <label class="form-label">Difficulty Level *</label>
                            <select name="difficulty_level" required class="form-input">
                                <option value="">Select difficulty</option>
                                <option value="beginner" {{#eq course.difficulty_level "beginner"}}selected{{/eq}}>Beginner</option>
                                <option value="intermediate" {{#eq course.difficulty_level "intermediate"}}selected{{/eq}}>Intermediate</option>
                                <option value="advanced" {{#eq course.difficulty_level "advanced"}}selected{{/eq}}>Advanced</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Estimated Duration (minutes)</label>
                            <input type="number" name="estimated_duration" value="{{course.estimated_duration}}"
                                   class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Course Settings -->
                <div class="card p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 rounded-lg flex items-center justify-center text-white text-xl mr-4">
                            ‚öôÔ∏è
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Course Settings</h2>
                            <p class="text-gray-600">Configure course behavior and rewards</p>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="form-label">Total XP Reward</label>
                            <input type="number" name="total_xp" value="{{course.total_xp}}" 
                                   class="form-input">
                            <p class="text-xs text-gray-500 mt-1">Total XP students can earn from this course</p>
                        </div>
                        <div>
                            <label class="form-label">Publication Status</label>
                            <select name="is_published" class="form-input">
                                <option value="false" {{#unless course.is_published}}selected{{/unless}}>Draft</option>
                                <option value="true" {{#if course.is_published}}selected{{/if}}>Published</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Published courses are visible to students</p>
                        </div>
                    </div>
                </div>

                <!-- Course Metadata -->
                {{#if course.created_at}}
                <div class="card p-6">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center text-white text-xl mr-4">
                            üìä
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Course Metadata</h2>
                            <p class="text-gray-600">Information about this course</p>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="form-label">Created Date</label>
                            <input type="text" value="{{course.created_at}}" readonly 
                                   class="form-input bg-gray-50">
                        </div>
                        {{#if course.updated_at}}
                        <div>
                            <label class="form-label">Last Updated</label>
                            <input type="text" value="{{course.updated_at}}" readonly 
                                   class="form-input bg-gray-50">
                        </div>
                        {{/if}}
                    </div>
                </div>
                {{/if}}

                <!-- Action Buttons -->
                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <div class="text-sm text-gray-500">
                        * Required fields
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="/teacher/courses" class="btn btn-secondary">
                            Cancel
                        </a>
                        <button type="submit" name="action" value="save" class="btn btn-secondary">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                        {{#if course.is_published}}
                        <button type="submit" name="action" value="unpublish" class="btn btn-secondary text-orange-600">
                            <i class="fas fa-eye-slash mr-2"></i>Unpublish
                        </button>
                        {{else}}
                        <button type="submit" name="action" value="publish" class="btn btn-primary">
                            <i class="fas fa-rocket mr-2"></i>Save & Publish
                        </button>
                        {{/if}}
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Form validation and interactivity
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            
            // Form validation
            form.addEventListener('submit', function(e) {
                const title = document.querySelector('input[name="title"]').value.trim();
                const category = document.querySelector('select[name="category"]').value;
                const difficulty = document.querySelector('select[name="difficulty_level"]').value;
                
                if (!title || !category || !difficulty) {
                    e.preventDefault();
                    alert('Please fill in all required fields (marked with *)');
                    return false;
                }

                // Show loading state
                const submitButton = e.submitter;
                const originalText = submitButton.innerHTML;
                
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';
                
                // Re-enable button after a delay in case of errors
                setTimeout(() => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
                }, 10000);
            });

            // Auto-hide success/error messages after 5 seconds
            const messages = document.querySelectorAll('.bg-green-100, .bg-red-100');
            messages.forEach(message => {
                setTimeout(() => {
                    message.style.opacity = '0';
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 300);
                }, 5000);
            });
        });
    </script>
</body>
</html>